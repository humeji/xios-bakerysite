---
description: Prevents direct commits, merges, or PRs involving the auto-generated shopify branch
globs: .github/workflows/sync-shopify-branch.yml,scripts/create-shopify-branch.sh
alwaysApply: true
---

# Shopify Branch Protection

The `shopify` branch is an **auto-generated orphan branch** used exclusively by the Shopify GitHub integration. It contains only the contents of `themes/current/` at root level.

## Rules

1. **NEVER commit directly to the `shopify` branch.** It is rebuilt from scratch on every sync.
2. **NEVER merge the `shopify` branch into `main` or any other branch.** It is a one-way mirror with no shared history.
3. **NEVER create a PR from or to the `shopify` branch.** PRs should only target `main`.
4. **NEVER manually edit files on the `shopify` branch.** All theme changes go through `themes/current/` on `main`.

## How It Works

- A GitHub Action (`.github/workflows/sync-shopify-branch.yml`) rebuilds the `shopify` branch every time `themes/current/` changes on `main`.
- Before every sync, the current `shopify` branch state is saved as a backup tag (`shopify-backup/YYYYMMDD-HHMMSS`).
- The branch can also be rebuilt manually via `workflow_dispatch` or by running `./scripts/create-shopify-branch.sh`.
- Shopify reads this branch to detect theme updates.

## Rollback

If a sync pushes broken code, revert to the previous backup:

```bash
git push --force origin shopify-backup/YYYYMMDD-HHMMSS^{}:shopify
```

Find available backups with: `git tag -l 'shopify-backup/*'`

## Flow

```
main (development) ──> shopify (auto-generated, read by Shopify)
```

One-way only. Never the reverse.
